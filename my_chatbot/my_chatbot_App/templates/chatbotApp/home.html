<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1"
    />
    <title>SocialBrain</title>
    {% load static %}
    <link
      rel="icon"
      href="{% static 'images/Icon.png' %}"
      type="image/png"
    />
    <link
      rel="stylesheet"
      href="{% static 'styles/styles.css' %}"
    />
  </head>
  <body>
    <div
      class="chatbot-aside-wrapper chatbot-aside-menu-wrapper-inactive"
      id="header-aside-menu-wrapper"
    >
      <aside
        class="chatbot-aside-menu"
        id="chatbot-aside-menu"
      >
        <div class="aside-menu-actions-wrapper">
          <!-- exit menu svg -->
          <svg
            id="aside-menu-exit"
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="#ffffff"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            role="button"
            focusable="true"
            aria-label="Exit aside menu"
            tabindex="1"
          >
            <title id="aside-exit-titleID">Exit aside menu</title>
            <desc id="aside-exit-descID">
              Icon representing a 'exit' for the aside menu
            </desc>
            <line
              x1="18"
              y1="6"
              x2="6"
              y2="18"
            ></line>
            <line
              x1="6"
              y1="6"
              x2="18"
              y2="18"
            ></line>
          </svg>
          <!---->

          <!-- create agent svg -->
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="#ffffff"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            role="button"
            focusable="true"
            aria-label="Create a new agent"
            tabindex="1"
          >
            <title id="aside-create-titleID">Create new agent</title>
            <desc id="aside-create-descID">
              Icon representing a button to create a new agent
            </desc>
            <path
              d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"
            ></path>
            <path
              d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"
            ></path>
          </svg>
          <!---->
        </div>

        <img
          src="{% static 'images/socialbrain.png' %}"
          alt="SocialBrain.ai Logo"
          class="logo"
          width="75"
          height="75"
        />

        <div class="aside-menu-searchbar">
          <!-- search icon svg -->
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="#000000"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            role="button"
            focusable="true"
            aria-label="Search agents"
            tabindex="1"
          >
            <title id="aside-searchbar-titleID">Search query button</title>
            <desc id="aside-searchbar-descID">
              Icon representing a button to query results
            </desc>
            <circle
              cx="11"
              cy="11"
              r="8"
            ></circle>
            <line
              x1="21"
              y1="21"
              x2="16.65"
              y2="16.65"
            ></line>
          </svg>
          <!---->
          <form>
            <input
              placeholder="Search Agents"
              type="text"
              id="aside-search-bar"
              class="aside-search-bar"
            />
          </form>
        </div>

          <div class="aside-previous-agents-wrapper">
            <p class="aside-previous-agents-text">My Agents</p>
        
            <div class="previous-agents-cards-wrapper">
                {% for agent in agents %}
                <div class="previous-agents-content-wrapper">
                    <p class="previous-agents-title">{{ agent.name }}</p>
                </div>
                {% empty %}
                <div class="previous-agents-content-wrapper">
                    <p class="previous-agents-title">No agents found.</p>
                </div>
                {% endfor %}
            </div>
          </div>

        <div class="aside-recommended-agents-wrapper">
          <p class="aside-recommended-agents-text">Recommended Agents</p>

          <div class="recommended-agents-cards-wrapper">
            <div class="recommended-agents-content-wrapper">
              <img
                class="recommended-agents-icon"
                src="{% static 'images/amazon.svg' %}"
                alt="Amazon's logo"
              />
              <p class="recommended-agents-title">Amazon</p>
            </div>

            <div class="recommended-agents-content-wrapper">
              <img
                class="recommended-agents-icon"
                src="{% static 'images/youtube.svg' %}"
                alt="YouTube's logo"
              />
              <p class="recommended-agents-title">YouTube</p>
            </div>

            <div class="recommended-agents-content-wrapper">
              <img
                class="recommended-agents-icon"
                src="{% static 'images/discord.svg' %}"
                alt="Discord's logo"
              />
              <p class="recommended-agents-title">Discord</p>
            </div>
          </div>
        </div>
      </aside>
    </div>

    <div class="chatbot-main-wrapper">
      <header>
        <nav class="chatbot-navigation">
          <!-- inline menu svg -->
          <svg
            id="header-hamburger-menu"
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="#ffffff"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            role="button"
            focusable="true"
            aria-label="Expand to view menu options"
            tabindex="1"
          >
            <title id="hamburger-menu-titleID">Hamburger menu button</title>
            <desc id="hamburger-menu-descID">
              Icon representing a toggle for the navigation menu and agents for
              the site
            </desc>
            <line
              x1="3"
              y1="12"
              x2="21"
              y2="12"
            ></line>
            <line
              x1="3"
              y1="6"
              x2="21"
              y2="6"
            ></line>
            <line
              x1="3"
              y1="18"
              x2="21"
              y2="18"
            ></line>
          </svg>
          <!---->
          <!-- inline profile svg -->
          {% if user.is_authenticated %}
          <div class="header-profile-wrapper">
            <div class="dropdown">
              <svg
                id="header-profile-menu"
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="#ffffff"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="feather feather-user"
                role="button"
                focusable="true"
                aria-label="Expand to view profile options"
                tabindex="1"
                onclick="toggleDropdown()"
              >
                <title id="user-profile-titleID">Profile dropdown menu</title>
                <desc id="user-profile-descID">
                  Icon representing a dropdown for profile options
                </desc>
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                <circle
                  cx="12"
                  cy="7"
                  r="4"
                ></circle>
              </svg>
              <div id="profileDropdown" class="dropdown-content">
                <a href="{% url 'profile' %}" class="dropdown-item">
                  <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon">
                    <circle cx="12" cy="12" r="3"></circle>
                    <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                  </svg>
                  Account Settings
                </a>
                <form action="{% url 'logout' %}" method="post" id="logout-form">
                  {% csrf_token %}
                  <a href="javascript:void(0);" onclick="document.getElementById('logout-form').submit();" class="dropdown-item logout-item">
                    <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon">
                      <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                      <polyline points="16 17 21 12 16 7"></polyline>
                      <line x1="21" y1="12" x2="9" y2="12"></line>
                    </svg>
                    Log Out
                  </a>
                </form>
              </div>
            </div>
          </div>
          {% else %}
            <div class="auth-buttons">
              <a href="{% url 'register' %}" class="auth-button register">Register</a>
              <a href="{% url 'login' %}" class="auth-button login">Login</a>
            </div>
          {% endif %}
        </nav>
      </header>

      <main
        class="chatbot-chat-wrapper"
        id="chatbot-chat-wrapper"
      ></main>

      <!-- chat box -->
      <div class="chatbox-wrapper">
        <div class="chatbot-chatbox-wrapper">
          <!-- paperclip svg -->
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="#ffffff"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            role="button"
            focusable="true"
            aria-label="Search agents"
            tabindex="1"
            class="chatbox-paperclip-icon"
          >
            <title id="chatbot-paperclip-titleID">
              Paperclip icon as a button
            </title>
            <desc id="chatbot-paperclip-descID">
              Paperclip icon to symbolize 'paste' or 'files'
            </desc>
            <path
              d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"
            ></path>
          </svg>
          <!---->

          <textarea
            placeholder="Chat with custom Agent"
            class="chatbot-chatbox-input"
            tabindex="0"
            dir="auto"
            rows="1"
            id="chatbot-chatbox-user-input"
          ></textarea>

          <!-- send svg -->
          <svg
            id="user-send-message"
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="#ffffff"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            role="button"
            focusable="true"
            aria-label="Search agents"
            tabindex="1"
            class="chatbox-send-icon-inactive chatbox-send-icon"
          >
            <title id="chatbot-send-titleID">Mail icon as a button</title>
            <desc id="chatbot-send-descID">
              Send or mail icon to symbolize sending a message
            </desc>
            <line
              x1="22"
              y1="2"
              x2="11"
              y2="13"
            ></line>
            <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
          </svg>
        </div>
      </div>
      <!---->
    </div>

    <script>
      // vars
      const hamburgerMenu = document.getElementById("header-hamburger-menu");

      const exitIcon = document.getElementById("aside-menu-exit");

      const asideMenuWrapper = document.getElementById(
        "header-aside-menu-wrapper"
      );

      const asideMenu = document.getElementById("chatbot-aside-menu");

      const chatbox = document.getElementById("chatbot-chat-wrapper");

      const sendMessage = document.getElementById("user-send-message");

      const userMessage = document.getElementById("chatbot-chatbox-user-input");

      // event listeners
      window.onload = scrollToBottom();

      asideMenu.addEventListener("click", (e) => e.stopPropagation());

      asideMenuWrapper.addEventListener("click", handleAsideMenuClose);

      hamburgerMenu.addEventListener("click", handleAsideMenuOpen);

      exitIcon.addEventListener("click", handleAsideMenuClose);

      hamburgerMenu.addEventListener("keypress", (e) =>
        e.key === "Enter" ? handleAsideMenuOpen(e) : null
      );

      exitIcon.addEventListener("keypress", (e) =>
        e.key === "Enter" ? handleAsideMenuClose(e) : null
      );

      userMessage.addEventListener("keypress", (e) => {
        if (e.key === "Enter") {
          e.preventDefault();
          return addUserMessage();
        }
      });

      sendMessage.addEventListener("click", addUserMessage);

      // event handlers

      function scrollToBottom() {
        const scrollableElement = document.querySelector(
          ".chatbot-chat-wrapper"
        );
        scrollableElement.scrollTop = scrollableElement.scrollHeight;
      }

      function handleAsideMenuOpen(e) {
        e.stopPropagation();

        asideMenu.classList.remove("chatbot-aside-menu-inactive");

        asideMenuWrapper.classList.remove(
          "chatbot-aside-menu-wrapper-inactive"
        );
      }

      function handleAsideMenuClose(e) {
        e.stopPropagation();

        asideMenu.classList.add("chatbot-aside-menu-inactive");

        asideMenuWrapper.classList.add("chatbot-aside-menu-wrapper-inactive");
      }

      function addAgentMessage(agentTitle, agentMessage) {
        chatbox.insertAdjacentHTML(
          "beforeend",
          `<div class="chatbot-chat-output-wrapper">
                <img
                  src="{% static 'images/Icon.png' %}"
                  alt="SocialBrain.ai Logo"
                  class="chatbot-chat-social-brain-icon"
                  width="36"
                  height="36"
                />

                <div class="chatbot-chat-output-content">
                  <div class="chatbot-chat-output-titles">
                    <p class="chatbot-chat-social-brain">Social Brain</p>
                    <p class="chatbot-chat-agent-name">${agentTitle}</p>
                  </div>
                  <div class="chatbot-chat-message">
                    <p class="chatbot-chat-message-content">
                      ${agentMessage}
                    </p>
                  </div>
                </div>
              </div>`
        );
      }

      function addUserMessage() {
        const userMessage = document.getElementById(
          "chatbot-chatbox-user-input"
        );

        const trimmedMessage = userMessage.value.trim();

        if (!trimmedMessage) return;

        chatbox.insertAdjacentHTML(
          "beforeend",
          `<div class="chatbot-user-output-wrapper">
                <div class="chatbot-user-output-content">
                  <div class="chatbot-user-message">
                    <p class="chatbot-user-message-content">
                      ${trimmedMessage}
                    </p>
                  </div>
                </div>
              </div>`
        );

        userMessage.value = "";

        // TEMPORARY, REMOVE

        addAgentMessage(
          "Amazon",
          "Hello! I see you're experiencing an issue with your Amazon Prime membership. I'm here to help. Could you please provide more details about the problem you're encountering? Whether it's related to billing, access to Prime benefits, or anything else, I'll do my best to guide you through resolving it."
        );
        scrollToBottom();
      }
      function toggleDropdown() {
            document.getElementById("profileDropdown").classList.toggle("show");
        }
        window.onclick = function(event) {
            if (!event.target.matches('#header-profile-menu')) {
                var dropdowns = document.getElementsByClassName("dropdown-content");
                for (var i = 0; i < dropdowns.length; i++) {
                    var openDropdown = dropdowns[i];
                    if (openDropdown.classList.contains('show')) {
                        openDropdown.classList.remove('show');
                    }
                }
            }
        }
    </script>
  </body>
</html>
